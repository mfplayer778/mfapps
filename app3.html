<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆåŠŸç‡ç®—å‡ºå›â…¡</title>

<style>
body{
  font-family: system-ui, -apple-system;
  background:#1e1e2f;
  color:#fff;
  margin:0;
  padding:6px;
  height:100vh;
  box-sizing:border-box;
}

h1{
  text-align:center;
  font-size:18px;
  margin:4px 0;
}

/* ===== ã‚°ãƒªãƒƒãƒ‰ ===== */
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
}

.box{
  border:2px solid #fff;
  border-radius:8px;
  padding:4px;
}

.box h2{
  text-align:center;
  margin:0 0 4px;
  font-size:14px;
}

.buttons{
  display:flex;
  flex-direction:column;
  gap:4px;
}

button{
  border:none;
  border-radius:8px;
  font-weight:bold;
}

/* â˜… æˆåŠŸï¼ãƒŸã‚¹ãƒœã‚¿ãƒ³ã‚’1.5å€ */
.success{
  background:#ff9933;
  height:48px;      /* â† 32px â†’ 48px */
  font-size:14px;
}

.miss{
  background:#66ccff;
  height:48px;      /* â† 32px â†’ 48px */
  font-size:14px;
}

.footer{
  text-align:center;
}

.value{font-size:12px}
.rate{font-size:18px;font-weight:bold}
.ci{font-size:11px;color:#ffeeaa}

/* ===== åˆè¨ˆ ===== */
.totalBox{
  margin-top:4px;
  border:2px solid #fff;
  border-radius:8px;
  padding:6px;
  text-align:center;
  background:#2b2b44;
}

.totalRate{font-size:22px;font-weight:bold}
.totalCI{font-size:12px;color:#ffeeaa}

/* ===== ãƒªã‚»ãƒƒãƒˆï¼‹éŸ³ ===== */
.resetSound{
  display:flex;
  gap:6px;
  margin-top:4px;
}

.reset{
  background:#ff6666;
  flex:1;
  height:38px;
  font-size:14px;
}

.soundToggle{
  background:#66dd88;
  width:90px;
  height:38px;
  font-size:13px;
}

/* ===== CSV ===== */
.csv{
  margin-top:4px;
  width:100%;
  height:36px;
  font-size:14px;
  background:#cdaeff;
  border-radius:8px;
}

/* ===== ãƒ¡ãƒ¢ ===== */
.memoSection{
  margin-top:4px;
  border:2px solid #fff;
  border-radius:8px;
  padding:4px;
}

textarea{
  width:100%;
  height:48px;
  background:#1e1e2f;
  color:#fff;
  border:none;
  resize:none;
  font-size:13px;
}
</style>
</head>

<body>
<h1>æˆåŠŸç‡ç®—å‡ºå›â…¡</h1>

<div class="grid" id="grid"></div>

<div class="totalBox">
  <div>ABCD åˆè¨ˆ</div>
  <div>æˆåŠŸï¼š<span id="ts">0</span> ï¼ ãƒŸã‚¹ï¼š<span id="tm">0</span></div>
  <div class="totalRate" id="totalRate">0.0%</div>
  <div class="totalCI" id="totalCI">0.0 - 0.0%</div>
</div>

<div class="resetSound">
  <button class="reset" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
  <button class="soundToggle" onclick="toggleSound()">ğŸ”Š éŸ³ON</button>
</div>

<button class="csv" onclick="exportCSV()">CSVå‡ºåŠ›</button>

<div class="memoSection">
  <textarea id="memo" placeholder="ãƒ¡ãƒ¢"></textarea>
</div>

<script>
/* ===== éŸ³ ===== */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
let soundOn=true;
function playTone(f,d=0.1,v=0.25){
  if(!soundOn)return;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value=f; g.gain.value=v;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+d);
}
function playOK(){playTone(880,0.12,0.3);}
function playNG(){playTone(440,0.12,0.25);}
function toggleSound(){
  soundOn=!soundOn;
  document.querySelector(".soundToggle").textContent=soundOn?"ğŸ”Š éŸ³ON":"ğŸ”‡ éŸ³OFF";
}

/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
const labels=["A","B","C","D"];
const data={};
const grid=document.getElementById("grid");

labels.forEach(l=>{
  data[l]={s:0,m:0};
  const box=document.createElement("div");
  box.className="box";
  box.innerHTML=`
    <h2>${l}</h2>
    <div class="buttons">
      <button class="success" onclick="add('${l}',1)">æˆåŠŸ</button>
      <button class="miss" onclick="add('${l}',0)">ãƒŸã‚¹</button>
    </div>
    <div class="footer">
      <div class="value">æˆåŠŸï¼š0 ï¼ ãƒŸã‚¹ï¼š0</div>
      <div class="rate">0.0%</div>
      <div class="ci">0.0 - 0.0%</div>
    </div>`;
  grid.appendChild(box);
  data[l].el=box;
});

function add(l,isS){
  isS?(data[l].s++,playOK()):(data[l].m++,playNG());
  update(l); updateTotal();
}

function update(l){
  const d=data[l],t=d.s+d.m;
  const r=t?(d.s/t*100).toFixed(1):"0.0";
  let ci="0.0 - 0.0";
  if(t){
    const p=d.s/t,se=Math.sqrt(p*(1-p)/t);
    ci=`${Math.max(0,(p-1.96*se)*100).toFixed(1)} - ${Math.min(100,(p+1.96*se)*100).toFixed(1)}`;
  }
  const f=d.el.querySelector(".footer");
  f.children[0].textContent=`æˆåŠŸï¼š${d.s} ï¼ ãƒŸã‚¹ï¼š${d.m}`;
  f.children[1].textContent=`${r}%`;
  f.children[2].textContent=`${ci}%`;
}

function updateTotal(){
  let s=0,m=0;
  labels.forEach(l=>{s+=data[l].s;m+=data[l].m;});
  const t=s+m;
  const r=t?(s/t*100).toFixed(1):"0.0";
  document.getElementById("ts").textContent=s;
  document.getElementById("tm").textContent=m;
  document.getElementById("totalRate").textContent=`${r}%`;
  let ci="0.0 - 0.0";
  if(t){
    const p=s/t,se=Math.sqrt(p*(1-p)/t);
    ci=`${Math.max(0,(p-1.96*se)*100).toFixed(1)} - ${Math.min(100,(p+1.96*se)*100).toFixed(1)}`;
  }
  document.getElementById("totalCI").textContent=ci;
}

function resetAll(){
  playNG();
  labels.forEach(l=>{data[l].s=0;data[l].m=0;update(l);});
  updateTotal();
  document.getElementById("memo").value="";
}

function exportCSV(){
  let csv="åŒºåˆ†,æˆåŠŸ,ãƒŸã‚¹,æˆåŠŸç‡\n";
  labels.forEach(l=>{
    const d=data[l],t=d.s+d.m;
    const r=t?(d.s/t*100).toFixed(1):"0.0";
    csv+=`${l},${d.s},${d.m},${r}\n`;
  });
  let s=0,m=0;
  labels.forEach(l=>{s+=data[l].s;m+=data[l].m;});
  const t=s+m;
  const r=t?(s/t*100).toFixed(1):"0.0";
  csv+=`åˆè¨ˆ,${s},${m},${r}\n\n`;
  csv+=`ãƒ¡ãƒ¢,"${document.getElementById("memo").value.replace(/"/g,'""')}"\n`;
  csv+=`å‡ºåŠ›æ—¥æ™‚,${new Date().toLocaleString()}\n`;
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="æˆåŠŸç‡ç®—å‡ºå›â…¡.csv";
  a.click();
}
</script>
</body>
</html>
