<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆåŠŸç‡ç®—å‡ºå›</title>

<style>
body{
  font-family:system-ui,-apple-system;
  background:#1e1e2f;
  color:#fff;
  margin:0;
  padding:8px;
}

h1{
  text-align:center;
  font-size:18px;
  margin-bottom:6px;
}

/* ===== ãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ ===== */
.mainButtons{
  display:flex;
  flex-direction:column;
  gap:8px;
}

button{
  font-weight:bold;
  border-radius:10px;
  border:none;
  color:#000;
}

.success,.miss{
  height:72px;
  font-size:18px;
}

.success{background:#ff9933;}
.miss{background:#66ccff;}

.reset{background:#ff6666;height:48px;flex:1;}
.soundToggle{background:#66dd88;height:48px;width:90px;font-size:14px;}
.csv{background:#b399ff;height:46px;width:100%;margin-top:6px;}

button:active{opacity:0.7}

/* ===== å…¥åŠ›æ¬„ ===== */
.inputSection{
  border:2px solid #fff;
  border-radius:10px;
  padding:8px;
  margin:6px 0;
}

.inputBox{
  width:100%;
  height:38px;
  font-size:18px;
  text-align:right;
  border-radius:6px;
  border:2px solid #fff;
  background:#1e1e2f;
  color:#fff;
  margin-bottom:6px;
  box-sizing:border-box; /* â˜…ã‚ºãƒ¬é˜²æ­¢ */
}

/* ===== ãƒ†ãƒ³ã‚­ãƒ¼ ===== */
.keypad{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
}

.keypad button{
  height:40px;
  font-size:16px;
  background:#bbb;
  border-radius:6px;
}

/* ===== çµæœ ===== */
.footer{
  background:#2b2b44;
  padding:8px;
  border-radius:8px;
  text-align:center;
}

.value{font-size:14px}
.rate{font-size:24px;font-weight:bold}
.ci{font-size:12px;color:#ffeeaa}

/* ===== ãƒªã‚»ãƒƒãƒˆ+éŸ³ ===== */
.resetSoundWrapper{
  display:flex;
  gap:6px;
  margin:6px 0;
}

/* ===== ãƒ¡ãƒ¢ ===== */
.memoSection{
  border:2px solid #fff;
  border-radius:10px;
  padding:6px;
  margin-top:6px;
}

.memoSection textarea{
  width:100%;
  height:56px;
  font-size:14px;
  border:none;
  background:#1e1e2f;
  color:#fff;
  resize:none;
  box-sizing:border-box;
}
</style>
</head>

<body>
<h1>æˆåŠŸç‡ç®—å‡ºå›</h1>

<div class="mainButtons">
  <button class="success" onclick="addSuccess()">æˆåŠŸ</button>
  <button class="miss" onclick="addMiss()">ãƒŸã‚¹</button>
</div>

<div class="inputSection">
  <input id="inputValue" class="inputBox" readonly placeholder="æ•°å€¤å…¥åŠ›">
  <div class="keypad">
    <button onclick="addNum(1)">1</button>
    <button onclick="addNum(2)">2</button>
    <button onclick="addNum(3)">3</button>
    <button onclick="addNum(4)">4</button>
    <button onclick="addNum(5)">5</button>
    <button onclick="addNum(6)">6</button>
    <button onclick="addNum(7)">7</button>
    <button onclick="addNum(8)">8</button>
    <button onclick="addNum(9)">9</button>
    <button onclick="clearNum()">C</button>
    <button onclick="addNum(0)">0</button>
    <button onclick="backspace()">â†</button>
  </div>
</div>

<div class="footer">
  <div class="value">æˆåŠŸï¼š<span id="success">0</span></div>
  <div class="value">ãƒŸã‚¹ï¼š<span id="miss">0</span></div>
  <div class="rate">æˆåŠŸç‡ï¼š<span id="rate">0.0</span>%</div>
  <div class="ci">95% ä¿¡é ¼åŒºé–“ï¼š<span id="ci">0.0 - 0.0</span>%</div>
</div>

<div class="resetSoundWrapper">
  <button class="reset" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
  <button class="soundToggle" onclick="toggleSound()">ğŸ”Š éŸ³ON</button>
</div>

<button class="csv" onclick="exportCSV()">CSVå‡ºåŠ›</button>

<div class="memoSection">
  <textarea id="memo" placeholder="ãƒ¡ãƒ¢æ¬„"></textarea>
</div>

<script>
/* ===== éŸ³ ===== */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
let soundOn=true;
function playTone(f,d=0.1,v=0.25){
  if(!soundOn)return;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value=f; g.gain.value=v;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime+d);
}
function ok(){playTone(880,0.12,0.3);}
function ng(){playTone(440,0.12,0.25);}
function toggleSound(){
  soundOn=!soundOn;
  document.querySelector(".soundToggle").textContent=soundOn?"ğŸ”Š éŸ³ON":"ğŸ”‡ éŸ³OFF";
}

/* ===== ãƒ­ã‚¸ãƒƒã‚¯ ===== */
let success=0,miss=0;
function getVal(){return Number(inputValue.value)||1;}

function update(){
  const t=success+miss;
  rate.textContent=t?(success/t*100).toFixed(1):"0.0";
  if(!t){ci.textContent="0.0 - 0.0";return;}
  const p=success/t,se=Math.sqrt(p*(1-p)/t);
  ci.textContent=
    `${Math.max(0,(p-1.96*se)*100).toFixed(1)} - ${Math.min(100,(p+1.96*se)*100).toFixed(1)}`;
}

function addSuccess(){ok();success+=getVal();successEl.textContent=success;update();clearNum();}
function addMiss(){ng();miss+=getVal();missEl.textContent=miss;update();clearNum();}
function resetAll(){ng();success=miss=0;successEl.textContent=0;missEl.textContent=0;update();clearNum();memo.value="";}

function addNum(n){inputValue.value+=n;}
function clearNum(){inputValue.value="";}
function backspace(){inputValue.value=inputValue.value.slice(0,-1);}

/* ===== CSV ===== */
function exportCSV(){
  const t=success+miss;
  const r=t?(success/t*100).toFixed(1):"0.0";
  let csv="æˆåŠŸ,ãƒŸã‚¹,æˆåŠŸç‡(%)\n";
  csv+=`${success},${miss},${r}\n\n`;
  csv+=`ãƒ¡ãƒ¢,"${memo.value.replace(/"/g,'""')}"\n`;
  csv+=`å‡ºåŠ›æ—¥æ™‚,${new Date().toLocaleString()}\n`;
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="æˆåŠŸç‡ç®—å‡ºçµæœ.csv";
  a.click();
}

/* short refs */
const inputValue=document.getElementById("inputValue");
const successEl=document.getElementById("success");
const missEl=document.getElementById("miss");
const rate=document.getElementById("rate");
const ci=document.getElementById("ci");
const memo=document.getElementById("memo");
</script>
</body>
</html>
